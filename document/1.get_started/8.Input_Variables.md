# Input Variables
あなたは既にTerraformで有効な構成を作るナレッジを得られていると思います。
しかし、まだアクセスキーやAMIなどの設定がハードコードされている状態だと思います。
実際にシェアしてバージョン管理をできるように、
パラメーターを用いた構成管理にする必要がある。
このページでは入力変数を使用する方法を紹介する。

## The Initial Configuration
もし最初からチュートリアルを進めてきたなら、
`learn-terraform-aws-instance`という名前のディレクトリを作り、
`example.tf`というファイルの中に以下のコードをペーストしていると思う。

```
provider "aws" {
  profile    = "default"
  region     = "us-east-1"
}

resource "aws_instance" "example" {
  ami           = "ami-b374d5a5"
  instance_type = "t2.micro"
}
```

## Defining Variables
最初に、リージョンを変数に展開する。
`variables.tf`という別のファイルを以下のコンテンツで作成して下さい。

    注意：Terraformはディレクトリないの全ての`.tf`という拡張子のファイルを読み込むため、ファイルの名前はどんな名前でも構いません。

```
variable "region" {
  default = "us-east-1"
}
```

これは`region`の変数をTerraformの構成管理の中で定義するものです。
`default`というのは変数を選択可能にします。
もし、デフォルトが設定されていないと、
このガイドで述べられている一つの変数を設定する必要がある。

## Using Variables in a Configuration
次に、providerの設定を次のように変更する。

```
provider "aws" {
  region = var.region
}
```
これは`region`と名付けられた変数で、`var.`という接頭辞を付ける。
それはTerraformに変数にアクセスし、ここで`region`変数をここで使用することを示している。
その設定で、与えられた変数により、AWS providerを設定する。

## Assigning variables
変数を設定する方法は複数あり、
紹介する順番で変数は選ばれる。

### Command-line flags
あなたは変数を直接、コマンドラインで`-var`フラグで設定できる。
どのTerraformコマンド、例えば`apply`, `plan`, `refresh`などでも使うことができる。

```
$ terraform apply \
  -var 'region=us-east-1'
```

もう一度、変数をこの方法で設定すると設定を保存せず、
コマンドとして実行する度に繰り返し入力しなければならない。

### From a file
変数の値を保持するため、ファイルを作り変数をファイルの中に入れて保存できる。
`terraform.tfvars`という名前のファイルを以下の内容で作成して下さい。

```
region = "us-east-1"
```

Terraformは自動的に今いるディレクトリの`terraform.tfvars`や`*.auto.tfvars`というファイルを自動的に読み込む。
もし、ファイルがこのパターンに当てはまらない名前であれば、
`-var-file`というフラグでファイル名を指定すれば使用できる。
これらのファイルはTerraformの構成設定と同じシンタックス（HCL）を使用する。
これらはJSON形式も適用できる。

私たちは、ユーザ名やパスワードをバージョンコントロールに保存することは推奨しない。
ローカルのファイルで、`secret.tfvars`というファイルで`-var-file`のフラグで読み込むのが良いかと思います。

`-var-file`の引数は一つのコマンドに対して複数呼び出すことができるので、
バージョンコントロールするものとしないものを分けて呼び出すことができます。

```
$ terraform apply \
  -var-file="secret.tfvars" \
  -var-file="production.tfvars"
```

    Tip: これはSTG環境と本番環境を同じ構成管理を使い分けてプロビジョニングする一つの方法です。
    

### From environment variables
Terraform will read environment variables in the form of TF_VAR_name to find the value for a variable. For example, the TF_VAR_region variable can be set in the shell to set the region variable in Terraform.

    Note: Environment variables can only populate string-type variables. List and map type variables must be populated via one of the other mechanisms.

### UI input
If you execute terraform apply with any variable unspecified, Terraform will ask you to input the values interactively. These values are not saved, but this provides a convenient workflow when getting started with Terraform. UI input is not recommended for everyday use of Terraform.

    Note: In Terraform versions 0.11 and earlier, UI input is only supported for string variables. List and map variables must be populated via one of the other mechanisms. Terraform 0.12 introduces the ability to populate complex variable types from the UI prompt.

### Variable defaults
If no value is assigned to a variable via any of these methods and the variable has a default key in its declaration, that value will be used for the variable.